<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>V√≤ng Quay S·ªë May M·∫Øn Trung Thu</title>
    <!-- T·∫£i Tailwind CSS v√† Font Montserrat -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700;900&display=swap" rel="stylesheet">
    
    <!-- T·∫£i Firebase SDKs -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, setDoc, collection, query, where, getDocs, deleteDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import { setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        
        // Kh·ªüi t·∫°o Firebase
        // ƒê·∫£m b·∫£o c√°c bi·∫øn __firebase_config v√† __app_id ƒë∆∞·ª£c x·ª≠ l√Ω an to√†n
        const firebaseConfig = JSON.parse(typeof __firebase_config !== 'undefined' ? __firebase_config : '{}');
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);
        setLogLevel('debug'); // B·∫≠t log debug cho Firestore
        
        // Bi·∫øn to√†n c·ª•c
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'trung-thu-spin-game';
        let currentUserId = null;
        
        const MAX_NUMBER = 200; 
        
        // M·∫≠t kh·∫©u Admin
        const ADMIN_SECRET = "midautumn2024"; 
        let isAdmin = false;
        
        // D·ªØ li·ªáu quay s·ªë ƒë∆∞·ª£c l∆∞u t·∫°m th·ªùi sau khi ƒëƒÉng k√Ω th√†nh c√¥ng
        let assignedSpinData = {
            finalNumber: null,
            playerName: null
        };

        // --- H√†m Ti·ªán √çch ---

        // T·∫°o UUID ng·∫´u nhi√™n
        function generateUUID() {
            return crypto.randomUUID();
        }

        // Hi·ªÉn th·ªã th√¥ng b√°o (thay th·∫ø alert)
        function showMessage(title, message, isError = false) {
            const modal = document.getElementById('messageModal');
            document.getElementById('modalTitle').textContent = title;
            document.getElementById('modalMessage').innerHTML = message;
            
            // ƒê·ªïi t√™n n√∫t ƒë√≥ng
            document.getElementById('closeModalBtn').textContent = 'Quay l·∫°i';
            
            const modalContent = document.getElementById('modalContent');
            
            // ƒê·∫∑t m√†u ti√™u ƒë·ªÅ theo lo·∫°i th√¥ng b√°o
            const titleElement = document.getElementById('modalTitle');
            titleElement.classList.remove('text-red-600', 'text-green-600');
            if (isError) {
                titleElement.classList.add('text-red-600');
            } else {
                titleElement.classList.add('text-red-600');
            }
            
            // NgƒÉn ch·∫∑n cu·ªôn body khi modal m·ªü
            document.body.style.overflow = 'hidden'; 
            
            // ƒê·∫£m b·∫£o modal hi·ªán l√™n v·ªõi animation
            modalContent.classList.remove('scale-0', 'opacity-0'); 
            modalContent.classList.add('modal-content-animated', 'animate-pop-in'); 
            
            modal.classList.remove('hidden');
        }
        
        function hideMessage() {
            const modalContent = document.getElementById('modalContent');
            
            // Cho ph√©p cu·ªôn l·∫°i body
            document.body.style.overflow = 'auto'; 
            
            // B·∫Øt ƒë·∫ßu animation ·∫©n
            modalContent.classList.remove('animate-pop-in');
            modalContent.classList.add('scale-0', 'opacity-0');
            
            setTimeout(() => {
                document.getElementById('messageModal').classList.add('hidden');
                modalContent.classList.remove('modal-content-animated'); // D·ªçn d·∫πp class animation
            }, 300); 
            
            // ƒê·∫£m b·∫£o n√∫t ƒëƒÉng k√Ω ƒë∆∞·ª£c k√≠ch ho·∫°t l·∫°i n·∫øu ƒëang ·ªü trang ƒëƒÉng k√Ω
             if (!document.getElementById('registrationPage').classList.contains('hidden')) {
                const spinBtn = document.getElementById('spinBtn');
                spinBtn.disabled = false;
                spinBtn.textContent = 'ƒêƒÉng K√Ω & Quay S·ªë!';
             }
        }

        // --- Logic Firebase v√† Auth ---
        
        async function authenticateUser() {
            const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;
            try {
                if (initialAuthToken) {
                    await signInWithCustomToken(auth, initialAuthToken);
                } else {
                    await signInAnonymously(auth);
                }
                currentUserId = auth.currentUser?.uid || generateUUID();
                document.getElementById('userIdDisplay').textContent = `ID Thi·∫øt B·ªã: ${currentUserId.substring(0, 8)}...`;
                console.log("X√°c th·ª±c Firebase th√†nh c√¥ng. User ID:", currentUserId);
                
                showPage('registrationPage');
            } catch (error) {
                console.error("L·ªói x√°c th·ª±c Firebase:", error);
                showMessage("L·ªói H·ªá Th·ªëng", "Kh√¥ng th·ªÉ k·∫øt n·ªëi d·ªãch v·ª•. Vui l√≤ng th·ª≠ l·∫°i.", true);
            }
        }
        
        // --- ƒê∆∞·ªùng d·∫´n Firestore ---

        function getPlayerCollectionPath() {
            // Public collection
            return `artifacts/${appId}/public/data/players`;
        }

        function getNumberStateDocPath() {
            // Public document for game state
            return `artifacts/${appId}/public/data/number_states/master_state`;
        }
        
        // --- Logic Admin L·ªãch S·ª≠ (Real-time) ---
        
        function loadAdminHistory() {
            if (!isAdmin) return;
            
            const playersRef = collection(db, getPlayerCollectionPath());
            const historyList = document.getElementById('adminSpinHistoryList');
            
            // L·∫Øng nghe thay ƒë·ªïi theo th·ªùi gian th·ª±c (onSnapshot)
            const unsubscribe = onSnapshot(playersRef, (snapshot) => {
                let historyHTML = '';
                const historyData = [];

                snapshot.forEach(doc => {
                    // L·∫•y d·ªØ li·ªáu v√† th√™m timestamp ƒë·ªÉ s·∫Øp x·∫øp
                    const data = doc.data();
                    historyData.push(data);
                });

                // S·∫Øp x·∫øp theo timestamp gi·∫£m d·∫ßn (m·ªõi nh·∫•t l√™n ƒë·∫ßu)
                historyData.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
                
                if (historyData.length === 0) {
                    historyHTML = '<tr><td colspan="4" class="p-3 text-center text-gray-500">Ch∆∞a c√≥ ng∆∞·ªùi ch∆°i n√†o tham gia.</td></tr>';
                } else {
                    historyData.forEach((player, index) => {
                        const time = new Date(player.timestamp).toLocaleTimeString('vi-VN', { hour: '2-digit', minute: '2-digit', second: '2-digit' });
                        const date = new Date(player.timestamp).toLocaleDateString('vi-VN');
                        
                        // M√†u ch·ªØ kh√°c nhau cho s·ªë ch·∫µn/l·∫ª
                        const numberClass = player.luckyNumber % 2 === 0 ? 'text-red-600' : 'text-yellow-600';

                        historyHTML += `
                            <tr class="${index % 2 === 0 ? 'bg-gray-50' : 'bg-white'} border-b border-gray-200">
                                <td class="p-3 text-left font-semibold text-sm">${player.facebookName || 'Kh√¥ng T√™n'}</td>
                                <td class="p-3 text-left font-mono text-xs text-gray-600">${player.phoneNumber || 'Kh√¥ng SƒêT'}</td>
                                <td class="p-3 text-center font-bold text-lg ${numberClass}">${player.luckyNumber}</td>
                                <td class="p-3 text-right text-sm text-gray-500">${time} (${date})</td>
                            </tr>
                        `;
                    });
                }
                historyList.innerHTML = historyHTML;
            }, (error) => {
                console.error("L·ªói khi t·∫£i l·ªãch s·ª≠ quay s·ªë Admin:", error);
            });
            return unsubscribe;
        }

        // --- Logic Quay S·ªë Ch√≠nh ---

        async function spinNumber() {
            const spinBtn = document.getElementById('spinBtn');
            const facebookName = document.getElementById('facebookName').value.trim(); 
            const phoneNumber = document.getElementById('phoneNumber').value.trim(); 
            
            if (!facebookName || !phoneNumber) {
                showMessage("L·ªói Nh·∫≠p Li·ªáu", "Vui l√≤ng nh·∫≠p **T√™n Facebook** v√† **S·ªë ƒëi·ªán tho·∫°i** ƒë·ªÉ tham gia.", true);
                return;
            }
            
            spinBtn.disabled = true;
            spinBtn.textContent = 'ƒêang Ki·ªÉm Tra & L·∫•y S·ªë...';

            try {
                const playersRef = collection(db, getPlayerCollectionPath());
                
                // 1. Ki·ªÉm tra ng∆∞·ªùi ch∆°i ƒë√£ quay ch∆∞a b·∫±ng S·ªê ƒêI·ªÜN THO·∫†I
                // S·ª≠ d·ª•ng query.where ƒë·ªÉ ƒë·∫£m b·∫£o m·ªói SƒêT ch·ªâ quay 1 l·∫ßn
                const q = query(playersRef, where("phoneNumber", "==", phoneNumber));
                const existingSpinSnapshot = await getDocs(q);

                if (!existingSpinSnapshot.empty) {
                    const existingData = existingSpinSnapshot.docs[0].data();
                    showMessage("B·∫°n ƒê√£ Quay R·ªìi!", 
                                `S·ªë ƒëi·ªán tho·∫°i **${phoneNumber}** ƒë√£ nh·∫≠n ƒë∆∞·ª£c **S·ªë May M·∫Øn ${existingData.luckyNumber}** tr∆∞·ªõc ƒë√≥. M·ªói SƒêT ch·ªâ ƒë∆∞·ª£c quay 1 l·∫ßn.`, 
                                true);
                    return; 
                }
                
                // 2. L·∫•y s·ªë may m·∫Øn duy nh·∫•t
                const masterStateDocRef = doc(db, getNumberStateDocPath());
                const stateSnapshot = await getDoc(masterStateDocRef);
                
                let availableNumbers = [];
                let allocatedNumbers = {};

                if (stateSnapshot.exists()) {
                    allocatedNumbers = stateSnapshot.data().allocatedNumbers || {};
                }
                
                for (let i = 1; i <= MAX_NUMBER; i++) {
                    if (!allocatedNumbers[i]) {
                        availableNumbers.push(i);
                    }
                }
                
                if (availableNumbers.length === 0) {
                    showMessage("H·∫øt S·ªë", "R·∫•t ti·∫øc, t·∫•t c·∫£ c√°c s·ªë may m·∫Øn (1-200) ƒë√£ ƒë∆∞·ª£c quay h·∫øt!");
                    return; 
                }

                const randomIndex = Math.floor(Math.random() * availableNumbers.length);
                const assignedNumber = availableNumbers[randomIndex];
                
                // 3. C·∫≠p nh·∫≠t tr·∫°ng th√°i s·ªë ƒë√£ quay (CHU·∫®N B·ªä L∆ØU)
                allocatedNumbers[assignedNumber] = {
                    phoneNumber: phoneNumber, 
                    timestamp: new Date().toISOString()
                };
                
                await setDoc(masterStateDocRef, { allocatedNumbers }, { merge: true });

                // 4. L∆∞u th√¥ng tin ng∆∞·ªùi ch∆°i v√† s·ªë quay 
                const playerDocData = {
                    userId: currentUserId,
                    facebookName: facebookName, 
                    phoneNumber: phoneNumber,   
                    luckyNumber: assignedNumber,
                    timestamp: new Date().toISOString()
                };
                
                // D√πng userId l√†m document ID ƒë·ªÉ d·ªÖ d√†ng theo d√µi
                const playerDocRef = doc(playersRef, currentUserId); 
                await setDoc(playerDocRef, playerDocData);

                // 5. L∆∞u s·ªë ƒë√£ quay v√†o bi·∫øn t·∫°m v√† chuy·ªÉn sang trang quay
                assignedSpinData.finalNumber = assignedNumber;
                assignedSpinData.playerName = facebookName;
                
                document.getElementById('spinBtn').textContent = 'ƒêƒÉng K√Ω Th√†nh C√¥ng!';

                showPage('spinPage');
                
            } catch (error) {
                console.error("L·ªói trong qu√° tr√¨nh quay s·ªë:", error);
                showMessage("L·ªói H·ªá Th·ªëng", "ƒê√£ x·∫£y ra l·ªói khi quay s·ªë. Vui l√≤ng ki·ªÉm tra l·∫°i k·∫øt n·ªëi.", true);
                spinBtn.disabled = false;
                spinBtn.textContent = 'ƒêƒÉng K√Ω & Quay S·ªë!';
            }
        }
        
        // Ch·ª©c nƒÉng m·ªõi: B·∫Øt ƒë·∫ßu Animation Quay s·ªë (Khi ng∆∞·ªùi d√πng nh·∫•n n√∫t)
        function startSpinAnimation() {
            const finalNumber = assignedSpinData.finalNumber;
            const playerName = assignedSpinData.playerName;
            
            if (finalNumber === null) {
                showMessage("L·ªói D·ªØ Li·ªáu", "Kh√¥ng t√¨m th·∫•y s·ªë may m·∫Øn ƒë√£ c·∫•p. Vui l√≤ng quay l·∫°i trang ƒëƒÉng k√Ω.", true);
                showPage('registrationPage');
                return;
            }
            
            const actualSpinBtn = document.getElementById('actualSpinBtn');
            actualSpinBtn.disabled = true;
            actualSpinBtn.textContent = 'ƒêANG QUAY...';
            actualSpinBtn.classList.remove('animate-pulse'); // T·∫Øt nh·∫•p nh√°y

            const wheel = document.getElementById('wheel');
            const resultDisplay = document.getElementById('resultDisplay');
            
            resultDisplay.textContent = 'ƒêang Quay S·ªë...';
            document.getElementById('resultContainer').classList.remove('hidden');
            wheel.classList.remove('animate-pulse-spin'); // T·∫Øt nh·∫•p nh√°y v√≤ng quay

            // LOGIC QUAY S·ªê (Animation ch·ªâ l√† h√¨nh th·ª©c)
            const degreesPerNumber = 360 / MAX_NUMBER; 
            const targetOffset = degreesPerNumber * 0.5; // Centers the pointer
            const numberAngle = (finalNumber * degreesPerNumber) + targetOffset;
            const rotationNeeded = 180 - numberAngle;
            // Quay 5 v√≤ng ƒë·∫ßy ƒë·ªß + v·ªÅ ƒë√∫ng v·ªã tr√≠ + 360 ƒë·ªô (ƒë·ªÉ ƒë·∫£m b·∫£o quay ƒë·ªß)
            const totalRotation = 5 * 360 + rotationNeeded + 360; 
            
            // 1. Reset rotation (ƒë·ªÉ ƒë·∫£m b·∫£o animation b·∫Øt ƒë·∫ßu t·ª´ ƒë·∫ßu)
            wheel.style.transition = 'none';
            wheel.style.transform = `rotate(0deg)`;

            // 2. Bu·ªôc tr√¨nh duy·ªát v·∫Ω l·∫°i (reflow)
            wheel.offsetHeight; 

            // 3. √Åp d·ª•ng animation quay 6 gi√¢y
            wheel.style.transition = 'transform 6s cubic-bezier(0.25, 0.1, 0.25, 1)'; 
            wheel.style.transform = `rotate(${totalRotation}deg)`;


            // Hi·ªÉn th·ªã k·∫øt qu·∫£ sau khi animation k·∫øt th√∫c
            setTimeout(() => {
                const resultText = `K·∫øt qu·∫£: ${finalNumber}`;
                resultDisplay.textContent = resultText;
                
                // ƒêi·ªÅu ch·ªânh v·ªã tr√≠ cu·ªëi c√πng
                const finalAngle = totalRotation % 360;
                wheel.style.transition = 'none'; 
                wheel.style.transform = `rotate(${finalAngle}deg)`;
                
                // --- K·∫æT QU·∫¢ QUAY S·ªê MODAL (ƒê√£ ƒëi·ªÅu ch·ªânh k√≠ch th∆∞·ªõc text) ---
                const messageContent = `
                    <div class="bg-white p-6 rounded-2xl border-4 border-red-600 shadow-xl mb-6">
                        <p class="text-xl md:text-3xl font-extrabold text-red-700 text-center mb-2 leading-snug text-readable-outline">
                            Xin Ch√∫c M·ª´ng, ${playerName}! 
                        </p>
                        <p class="text-lg md:text-xl text-gray-700 font-semibold text-center mt-3 text-readable-outline" style="text-shadow: -1px -1px 0 #fff, 1px -1px 0 #fff, -1px 1px 0 #fff, 1px 1px 0 #fff;">
                            S·ªë May M·∫Øn C·ªßa B·∫°n L√†: 
                        </p>
                        <div class="mt-4">
                            <span class="block text-5xl md:text-6xl font-black text-red-900" style="text-shadow: 
                                -3px -3px 0 #fcd34d, 3px -3px 0 #fcd34d, 
                                -3px 3px 0 #fcd34d, 3px 3px 0 #fcd34d,
                                0 0 15px #ff0, 0 0 20px #ffc107;">
                                ${finalNumber}
                            </span>
                        </div>
                    </div>
                    <p class="mb-4 text-center text-gray-700 text-sm">Vui l√≤ng ch·ª•p m√†n h√¨nh ho·∫∑c ghi nh·ªõ SƒêT ƒë·ªÉ ƒë·ªëi chi·∫øu.</p>
                `;
                
                showMessage("ü•≥ K·∫æT QU·∫¢ MAY M·∫ÆN! ü•≥", messageContent);
                
                // Sau khi quay xong, reset data t·∫°m th·ªùi v√† ·∫©n n√∫t quay
                assignedSpinData.finalNumber = null;
                assignedSpinData.playerName = null;
                // Kh√¥ng ·∫©n n√∫t quay m√† ƒë·ªÉ ·ªü tr·∫°ng th√°i disabled v√† ƒë·ªïi text
                actualSpinBtn.textContent = 'ƒê√É QUAY XONG';
                actualSpinBtn.classList.remove('animate-pulse');

            }, 6000); 
        }
        
        // --- Logic Admin (Gi·ªØ nguy√™n) ---

        let historyUnsubscribe = null;

        function checkAdminLogin() {
            const password = document.getElementById('adminPassword').value;
            if (password === ADMIN_SECRET) {
                isAdmin = true;
                document.getElementById('adminLoginError').textContent = '';
                showPage('adminDashboard');
                historyUnsubscribe = loadAdminHistory(); 
                updateAdminDashboard();
            } else {
                document.getElementById('adminLoginError').textContent = 'M·∫≠t kh·∫©u kh√¥ng ƒë√∫ng.';
                document.getElementById('adminPassword').value = '';
            }
        }

        async function updateAdminDashboard() {
            const masterStateDocRef = doc(db, getNumberStateDocPath());
            const stateSnapshot = await getDoc(masterStateDocRef);
            
            let allocatedCount = 0;
            if (stateSnapshot.exists()) {
                const allocatedNumbers = stateSnapshot.data().allocatedNumbers || {};
                allocatedCount = Object.keys(allocatedNumbers).length;
            }

            document.getElementById('numbersAllocated').textContent = allocatedCount;
            document.getElementById('numbersRemaining').textContent = MAX_NUMBER - allocatedCount;
            document.getElementById('totalNumbers').textContent = MAX_NUMBER;
        }

        async function resetGameData() {
            const modalTitle = "X√°c Nh·∫≠n Thi·∫øt L·∫≠p L·∫°i";
            const modalMessage = `
                <p class="text-lg font-bold text-red-600 mb-3 text-readable-outline">B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën X√ìA T·∫§T C·∫¢ d·ªØ li·ªáu kh√¥ng?</p>
                <p class="text-sm">H√†nh ƒë·ªông n√†y s·∫Ω x√≥a to√†n b·ªô s·ªë ƒë√£ ƒë∆∞·ª£c c·∫•p ph√°t v√† l·ªãch s·ª≠ ng∆∞·ªùi ch∆°i. Kh√¥ng th·ªÉ ho√†n t√°c.</p>
                <div class="flex justify-around mt-4">
                    <button id="confirmResetBtn" class="py-2 px-4 rounded-lg bg-red-600 text-white font-bold hover:bg-red-700 transition duration-150">X√°c Nh·∫≠n X√≥a</button>
                    <button id="cancelResetBtn" class="py-2 px-4 rounded-lg bg-gray-300 text-gray-800 font-bold hover:bg-gray-400">H·ªßy B·ªè</button>
                </div>
            `;

            showMessage(modalTitle, modalMessage, true);
            
            // Logic x·ª≠ l√Ω n√∫t trong modal
            document.getElementById('confirmResetBtn').onclick = async () => {
                hideMessage();
                try {
                    const masterStateDocRef = doc(db, getNumberStateDocPath());
                    await setDoc(masterStateDocRef, { allocatedNumbers: {} }); 

                    const playersRef = collection(db, getPlayerCollectionPath());
                    const querySnapshot = await getDocs(playersRef);
                    
                    querySnapshot.forEach(async (d) => {
                        await deleteDoc(doc(playersRef, d.id));
                    });

                    showMessage("Th√†nh c√¥ng", "ƒê√£ thi·∫øt l·∫≠p l·∫°i to√†n b·ªô d·ªØ li·ªáu tr√≤ ch∆°i.");
                    updateAdminDashboard();
                    
                } catch (error) {
                    console.error("L·ªói khi reset game:", error);
                    showMessage("L·ªói", "Kh√¥ng th·ªÉ thi·∫øt l·∫≠p l·∫°i tr√≤ ch∆°i. Vui l√≤ng ki·ªÉm tra console log.", true);
                }
            };
            document.getElementById('cancelResetBtn').onclick = hideMessage;
            
            // ƒê·∫∑t l·∫°i s·ª± ki·ªán ƒë√≥ng m·∫∑c ƒë·ªãnh
            document.getElementById('closeModalBtn').onclick = hideMessage;
        }


        function logoutAdmin() {
            isAdmin = false;
            document.getElementById('adminPassword').value = '';
            if (historyUnsubscribe) {
                historyUnsubscribe(); 
                historyUnsubscribe = null;
            }
            showPage('registrationPage');
        }
        
        // --- Qu·∫£n l√Ω Giao di·ªán ---
        
        function showPage(pageId) {
            document.querySelectorAll('.page').forEach(page => {
                page.classList.add('hidden');
            });
            document.getElementById(pageId).classList.remove('hidden');

            const resultContainer = document.getElementById('resultContainer');
            const wheel = document.getElementById('wheel');
            const actualSpinBtn = document.getElementById('actualSpinBtn');
            
            if (pageId === 'spinPage') {
                // Trang ch·ªù quay: Hi·ªán n√∫t QUAY, ·∫©n khung k·∫øt qu·∫£
                wheel.classList.add('animate-pulse-spin');
                resultContainer.classList.add('hidden');
                
                // Hi·ªán n√∫t quay v√† ƒë·∫∑t l·∫°i tr·∫°ng th√°i ch·ªù ·∫•n
                actualSpinBtn.classList.remove('hidden');
                actualSpinBtn.disabled = false;
                actualSpinBtn.textContent = 'QUAY V√íNG MAY M·∫ÆN!';
                actualSpinBtn.classList.add('animate-pulse'); // M·ªùi ng∆∞·ªùi d√πng ·∫•n
            } else if (pageId === 'registrationPage') {
                 // Reset v·ªã tr√≠ v√≤ng quay v·ªÅ 0, th√™m nh·∫•p nh√°y, ·∫©n khung k·∫øt qu·∫£ v√† n√∫t quay
                 wheel.style.transition = 'none';
                 wheel.style.transform = `rotate(0deg)`;
                 wheel.classList.add('animate-pulse-spin');
                 resultContainer.classList.add('hidden'); 
                 actualSpinBtn.classList.add('hidden');
                 
                 // ƒê·∫£m b·∫£o n√∫t ƒëƒÉng k√Ω lu√¥n s·∫µn s√†ng
                 document.getElementById('spinBtn').disabled = false;
                 document.getElementById('spinBtn').textContent = 'ƒêƒÉng K√Ω & Quay S·ªë!';
                 
                 // X√≥a d·ªØ li·ªáu t·∫°m (n·∫øu c√≥)
                 assignedSpinData.finalNumber = null;
                 assignedSpinData.playerName = null;
            } else {
                 // C√°c trang kh√°c (Admin)
                 wheel.classList.remove('animate-pulse-spin');
                 resultContainer.classList.add('hidden');
            }
        }
        
        // --- Logic Hi·ªÉn th·ªã S·ªë tr√™n V√≤ng Quay ---

        function renderWheelNumbers() {
            const wheel = document.getElementById('wheel');
            const degreesPerNumber = 360 / MAX_NUMBER; // 1.8 ƒë·ªô / s·ªë

            // ƒêi·ªÅu ch·ªânh k√≠ch th∆∞·ªõc v√≤ng quay theo k√≠ch th∆∞·ªõc m√†n h√¨nh
            let currentWheelRadius = 200; 
            if (window.innerWidth <= 600) {
                 currentWheelRadius = 150; 
            }

            wheel.innerHTML = ''; // X√≥a c√°c s·ªë c≈©

            // Ch·ªâ hi·ªÉn th·ªã c√°c m·ªëc s·ªë (10, 20, 30, ... 200)
            for (let i = 1; i <= MAX_NUMBER; i++) {
                if (i % 10 === 0) { 
                    const numberDiv = document.createElement('div');
                    numberDiv.textContent = i;
                    // Class ƒë·ªÉ l√†m n·ªïi b·∫≠t m·ªëc
                    numberDiv.classList.add('number-text-marker', 'font-black', 'text-xl', 'text-white', 'text-readable-outline'); 

                    const rotation = i * degreesPerNumber; // G√≥c quay c·ªßa s·ªë
                    
                    numberDiv.style.setProperty('--rotation', `${rotation}deg`);

                    // T√≠nh to√°n v·ªã tr√≠ v√† xoay
                    numberDiv.style.cssText += `
                        position: absolute;
                        width: 30px;
                        height: 20px;
                        top: 50%;
                        left: 50%;
                        transform: 
                            rotate(${rotation}deg) 
                            translate(${currentWheelRadius * 0.75}px) 
                            rotate(-90deg); 
                        transform-origin: 0 0;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        user-select: none;
                        z-index: 15;
                    `;
                    wheel.appendChild(numberDiv);
                }
            }
            wheel.classList.add('animate-pulse-spin');
        }

        
        // Kh·ªüi t·∫°o v√† li√™n k·∫øt s·ª± ki·ªán
        window.onload = function() {
            // V·∫Ω c√°c con s·ªë (m·ªëc) l√™n v√≤ng quay
            renderWheelNumbers();

            // X·ª≠ l√Ω khi resize ƒë·ªÉ ƒë·∫£m b·∫£o s·ªë tr√™n v√≤ng quay ƒë√∫ng v·ªã tr√≠ 
            window.addEventListener('resize', () => {
                const newRadius = window.innerWidth <= 600 ? 150 : 200;
                // Ki·ªÉm tra k√≠ch th∆∞·ªõc hi·ªán t·∫°i c·ªßa b√°nh xe ƒë·ªÉ tr√°nh t√≠nh to√°n l·∫°i kh√¥ng c·∫ßn thi·∫øt
                const currentWheelWidth = document.getElementById('wheel').clientWidth;
                const expectedWidth = newRadius * 2;
                if (currentWheelWidth !== expectedWidth) {
                    renderWheelNumbers();
                }
            });

            // Kh·ªüi t·∫°o x√°c th·ª±c
            authenticateUser();
            
            // Li√™n k·∫øt s·ª± ki·ªán
            document.getElementById('spinBtn').addEventListener('click', spinNumber);
            document.getElementById('actualSpinBtn').addEventListener('click', startSpinAnimation); // N√∫t quay m·ªõi
           
            document.getElementById('closeModalBtn').addEventListener('click', hideMessage);
            document.getElementById('backToRegBtn').addEventListener('click', () => showPage('registrationPage'));
            
            // Logic Admin ·∫©n
            document.getElementById('hiddenAdminLink').addEventListener('click', (e) => {
                 e.preventDefault();
                 showPage('adminLoginPage');
            });
            document.getElementById('adminLoginBtn').addEventListener('click', checkAdminLogin);
            document.getElementById('adminLogoutBtn').addEventListener('click', logoutAdmin);
            document.getElementById('resetGameBtn').addEventListener('click', resetGameData);
            document.getElementById('backFromAdminBtn').addEventListener('click', logoutAdmin); 
            
            document.getElementById('adminPassword').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    checkAdminLogin();
                }
            });
        };

    </script>

    <style>
        /* CSS C·ªë ƒë·ªãnh */
        body {
            font-family: 'Montserrat', sans-serif;
            color: #4a5568;
            min-height: 100vh;
            /* ƒê·ªïi n·ªÅn ƒë·ªÉ l√†m n·ªïi b·∫≠t √°nh trƒÉng v√† l·ªìng ƒë√®n */
            background: radial-gradient(circle at 50% 100%, #171c35 0%, #0c0a09 100%);
            /* CSS s·∫Ω ƒë∆∞·ª£c ƒëi·ªÅu ch·ªânh b·∫±ng JS ƒë·ªÉ qu·∫£n l√Ω cu·ªôn */
            overflow: auto; 
        }

        /* --- STYLES B·ªî SUNG THEO Y√äU C·∫¶U --- */

        /* Hi·ªáu ·ª©ng vi·ªÅn ch·ªØ m·ªèng (outline) ƒë·ªÉ ƒë·∫£m b·∫£o d·ªÖ ƒë·ªçc */
        .text-readable-outline {
            text-shadow:
                -1px -1px 0 #000, 1px -1px 0 #000, -1px 1px 0 #000, 1px 1px 0 #000;
        }

        /* T·∫°o h√¨nh ·∫£nh m·∫∑t trƒÉng tr√≤n v·ªõi √°nh s√°ng v√†ng d·ªãu */
        .full-moon {
            position: absolute;
            top: 50px;
            right: 50px;
            width: 150px;
            height: 150px;
            background-color: #ffe08a; /* M√†u v√†ng nh·∫°t c·ªßa trƒÉng */
            border-radius: 50%;
            /* Hi·ªáu ·ª©ng √°nh trƒÉng s√°ng (box-shadow) */
            box-shadow: 
                0 0 30px 10px #fff7b0, /* √Ånh s√°ng g·∫ßn */
                0 0 80px 30px #ffe780; /* √Ånh s√°ng lan t·ªèa */
            z-index: 5;
        }
        
        /* Thi·∫øt k·∫ø ƒë√®n l·ªìng */
        .lantern {
            position: absolute;
            width: 40px;
            height: 60px;
            background-color: #ff4500; /* M√†u ƒë·ªè r·ª±c */
            border-radius: 50% / 60% 60% 10% 10%;
            border: 2px solid #ffd700; /* Vi·ªÅn v√†ng */
            /* Hi·ªáu ·ª©ng √°nh s√°ng ƒë√®n l·ªìng */
            box-shadow: 0 0 15px 5px rgba(255, 140, 0, 0.9), inset 0 0 5px rgba(255, 255, 0, 0.5);
            z-index: 10;
            animation: swing 4s ease-in-out infinite alternate; /* Hi·ªáu ·ª©ng ƒëung ƒë∆∞a */
        }

        .lantern::after {
            content: '';
            position: absolute;
            bottom: -15px;
            left: 50%;
            transform: translateX(-50%);
            width: 10px;
            height: 15px;
            background-color: #ff8c00; /* Tua rua v√†ng cam */
            clip-path: polygon(0 0, 100% 0, 50% 100%);
        }
        
        /* Hi·ªáu ·ª©ng ƒëung ƒë∆∞a cho ƒë√®n l·ªìng */
        @keyframes swing {
            0% { transform: rotate(-3deg); }
            100% { transform: rotate(3deg); }
        }

        /* --- STYLES CH·ª¶ ƒê·ªÄ CHUNG --- */
        
        .mid-autumn-card {
            background-color: #ffffff;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4);
            border: 4px solid #f97316;
        }
        
        .mid-autumn-btn {
            background-color: #ef4444;
            color: #ffffff;
            transition: background-color 0.3s, transform 0.2s;
            box-shadow: 0 4px 0 #b91c1c;
        }
        .mid-autumn-btn:hover {
            background-color: #dc2626;
            transform: scale(1.02);
            box-shadow: 0 2px 0 #991b1b;
        }
        .mid-autumn-btn:active {
             transform: scale(0.98) translateY(2px);
             box-shadow: none;
        }
        .mid-autumn-btn:disabled {
            background-color: #f6ad55;
            cursor: not-allowed;
            box-shadow: none;
        }
        
        .lion-banner-title {
            color: #fde047; /* Gi·ªØ m√†u v√†ng r·ª±c r·ª° */
            text-shadow: 
                -3px -3px 0 #b91c1c, /* Vi·ªÅn ƒë·ªè m·∫°nh */
                3px -3px 0 #b91c1c, 
                -3px 3px 0 #b91c1c, 
                3px 3px 0 #b91c1c,
                0 0 20px rgba(253, 224, 71, 1); /* TƒÉng ƒë·ªô s√°ng */
        }

        /* --- CSS V√≤ng Quay N·ª¨A H√åNH TR√íN TR√äN (Responsive) --- */
        
        #wheel-container {
            width: 400px;
            height: 400px; 
            margin: 0 auto;
            position: relative;
        }
        
        #wheel-wrapper {
            width: 400px;
            height: 200px; 
            overflow: hidden; 
            position: absolute;
            top: 0; 
            left: 0;
            border: 5px solid #fcd34d;
            border-bottom: none;
            border-radius: 200px 200px 0 0; 
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.4);
            z-index: 10;
            background-color: #fff;
        }
        
        #wheel {
            width: 400px;
            height: 400px;
            border-radius: 50%;
            transition: none; 
            background: conic-gradient(
                #f97316 0% 5%, #fed7aa 5% 10%, #fbbf24 10% 15%, #ef4444 15% 20%,
                #f97316 20% 25%, #fed7aa 25% 30%, #fbbf24 30% 35%, #ef4444 35% 40%,
                #f97316 40% 45%, #fed7aa 45% 50%, #fbbf24 50% 55%, #ef4444 55% 60%,
                #f97316 60% 65%, #fed7aa 65% 70%, #fbbf24 70% 75%, #ef4444 75% 80%,
                #f97316 80% 85%, #fed7aa 85% 90%, #fbbf24 90% 95%, #ef4444 95% 100%
            );
            border: 10px solid #fcd34d;
            position: absolute;
            top: 0; 
            left: 0;
            transform: rotate(0deg);
        }

        /* Responsive adjustments for mobile */
        @media (max-width: 600px) {
            #wheel-container {
                width: 300px;
                height: 300px;
            }
            #wheel-wrapper {
                width: 300px;
                height: 150px;
                border-radius: 150px 150px 0 0;
            }
            #wheel {
                width: 300px;
                height: 300px;
                top: 0; 
            }
            .lantern-pointer {
                bottom: -20px;
                width: 40px;
                height: 40px;
            }
            /* Gi√° tr·ªã 112px = 150px (radius) * 0.75 */
            .number-text-marker {
                transform: rotate(var(--rotation)) translate(112px) rotate(-90deg) !important;
            }
            .full-moon {
                width: 80px;
                height: 80px;
                top: 20px;
                right: 20px;
            }
            .lion-banner-title {
                font-size: 2.5rem; /* T∆∞∆°ng ƒë∆∞∆°ng text-4xl */
            }
        }
        /* End Responsive Wheel */

        .number-text-marker {
             --rotation: 0deg;
        }
        
        /* Hi·ªáu ·ª©ng nh·∫•p nh√°y cho v√≤ng quay khi ch·ªù ƒëƒÉng k√Ω */
        @keyframes wheel-pulse {
            0% { box-shadow: 0 0 15px rgba(239, 68, 68, 0.5); }
            50% { box-shadow: 0 0 25px rgba(252, 211, 77, 0.8); }
            100% { box-shadow: 0 0 15px rgba(239, 68, 68, 0.5); }
        }
        .animate-pulse-spin {
            animation: wheel-pulse 2s infinite alternate ease-in-out;
        }
        
        /* Hi·ªáu ·ª©ng nh·∫•p nh√°y cho n√∫t QUAY m·ªõi (m·ªùi ng∆∞·ªùi d√πng ·∫•n) */
        @keyframes pulse {
            0%, 100% {
                opacity: 1;
                transform: scale(1);
            }
            50% {
                opacity: 0.8;
                transform: scale(1.03);
            }
        }
        .animate-pulse {
            animation: pulse 1s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }

        .lantern-pointer {
            position: absolute;
            bottom: -25px;
            left: 50%;
            transform: translateX(-50%);
            width: 50px;
            height: 50px;
            z-index: 20; 
            color: #ef4444; 
            filter: drop-shadow(0 0 8px #fde047);
        }
        
        .lantern-pointer svg {
             transform: rotate(180deg);
        }
        
        @keyframes glow {
            0%, 100% { filter: drop-shadow(0 0 8px #fde047); }
            50% { filter: drop-shadow(0 0 15px #ef4444); }
        }
        .animate-lantern-glow {
            animation: glow 3s ease-in-out infinite alternate;
        }

        /* CSS Modal Animation */
        .modal-container {
            transition: opacity 0.3s ease;
            backdrop-filter: blur(5px); /* L√†m m·ªù n·ªÅn cho r√µ r√†ng h∆°n */
        }
        @keyframes modal-pop-in {
            0% { transform: scale(0.5) translateY(100px); opacity: 0; }
            60% { transform: scale(1.1) translateY(0); opacity: 1; }
            100% { transform: scale(1); }
        }
        .animate-pop-in {
            animation: modal-pop-in 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55) forwards;
        }
        .modal-content-animated { 
            transition: none !important;
        }
        
        /* Decoration CSS */
        .decoration-svg {
            position: absolute;
            z-index: 0;
            filter: drop-shadow(0 0 5px rgba(255, 255, 255, 0.3));
        }

        @keyframes float {
            0% { transform: translateY(0px) rotate(0deg); }
            50% { transform: translateY(-10px) rotate(2deg); }
            100% { transform: translateY(0px) rotate(0deg); }
        }
        .animate-float {
            animation: float 5s infinite ease-in-out alternate;
        }
        
        @keyframes move-cloud {
            0% { transform: translateX(0); }
            100% { transform: translateX(50px); }
        }
        .animate-cloud {
            animation: move-cloud 15s infinite alternate ease-in-out;
        }
        
        /* Custom scrollbar for Admin table */
        .custom-scrollbar::-webkit-scrollbar {
            width: 6px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background-color: #f97316;
            border-radius: 3px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
            background: #ffe6cc;
        }
    </style>
</head>
<body class="flex flex-col items-center pt-8 md:pt-16 min-h-screen p-4 relative">
    
    <!-- KHU V·ª∞C TRANG TR√ç M·∫∂T TRƒÇNG V√Ä ƒê√àN L·ªíNG (Responsive/Z-index cao h∆°n n·ªÅn) -->
    <div class="full-moon hidden md:block"></div>
    <!-- ƒê√®n l·ªìng ƒë∆∞·ª£c ƒë·∫∑t v·ªã tr√≠ tuy·ªát ƒë·ªëi, ph√π h·ª£p cho m·ªçi k√≠ch th∆∞·ªõc -->
    <div class="lantern" style="top: 20px; left: 10%; transform: scale(1.2);"></div>
    <div class="lantern hidden md:block" style="top: 150px; left: 5%; transform: scale(0.9); animation-delay: 1s;"></div>
    <div class="lantern" style="top: 50px; right: 20%; animation-delay: 0.5s;"></div>
    <div class="lantern hidden md:block" style="top: 20px; right: 5%; transform: scale(1.1); animation-delay: 1.5s;"></div>
    <div class="lantern hidden lg:block" style="bottom: 50px; left: 15%; transform: scale(0.8); animation-delay: 2s;"></div>
    <div class="lantern hidden lg:block" style="bottom: 20px; right: 10%; animation-delay: 2.5s;"></div>
    <div class="lantern" style="top: 10%; left: 30%; transform: scale(1.3); animation-delay: 0.2s;"></div>
    <div class="lantern" style="top: 10%; right: 30%; transform: scale(0.7); animation-delay: 0.8s;"></div>
    
    <!-- Trang Tr√≠ 3: M·∫∑t TrƒÉng L·ªõn (N·∫±m sau v√≤ng quay) -->
    <!-- K√≠ch th∆∞·ªõc ƒë∆∞·ª£c ƒëi·ªÅu ch·ªânh ƒë·ªÉ kh√¥ng l√†m lu m·ªù giao di·ªán ch√≠nh tr√™n mobile -->
    <div class="decoration-svg absolute top-1/2 left-1/2 -translate-x-1/2" style="width: 80vw; max-width: 500px; height: 500px; margin-top: -150px; z-index: 0;">
        <svg viewBox="0 0 100 100" fill="#fef9c3" class="w-full h-full opacity-90 filter drop-shadow-lg">
            <title>M·∫∑t TrƒÉng R·∫±m N·ªÅn</title>
            <circle cx="50" cy="50" r="45"/>
            <circle cx="35" cy="40" r="6" fill="#fcd34d" opacity="0.3"/>
            <circle cx="65" cy="65" r="8" fill="#fcd34d" opacity="0.4"/>
            <circle cx="55" cy="30" r="4" fill="#fcd34d" opacity="0.3"/>
        </svg>
    </div>
    
    <!-- Trang Tr√≠ (M√¢y, Th·ªè, L·ªìng ƒê√®n) - Gi·ªØ nguy√™n v√† th√™m hidden mobile cho b·ªõt r·ªëi -->
    <div class="decoration-svg top-16 left-1/4 w-32 h-10 animate-cloud hidden md:block" style="color: #ffffff; opacity: 0.6; animation-delay: 2s;">
        <svg viewBox="0 0 400 100" fill="currentColor"><title>ƒê√°m M√¢y</title><path d="M 20 60 Q 70 20, 120 60 Q 170 30, 220 60 Q 270 20, 320 60 L 320 100 L 20 100 Z"/></svg>
    </div>
    <div class="decoration-svg top-24 right-1/4 w-40 h-12 animate-cloud hidden md:block" style="color: #ffffff; opacity: 0.4; animation-delay: 0s; transform: scaleX(-1);">
        <svg viewBox="0 0 400 100" fill="currentColor"><title>ƒê√°m M√¢y</title><path d="M 20 60 Q 70 20, 120 60 Q 170 30, 220 60 Q 270 20, 320 60 L 320 100 L 20 100 Z"/></svg>
    </div>

    <div class="decoration-svg top-8 left-4 w-20 h-20 animate-float hidden md:block" style="--tw-translate-y: -10px; color: #fcd34d;">
        <svg viewBox="0 0 512 512" fill="currentColor"><title>Th·ªè Ng·ªçc</title><path d="M239.1 36.9c-24.6-24.6-64.4-24.6-89 0l-7.1 7.1c-4.7 4.7-6.9 11.2-6.5 17.7l1.7 27.6L222.1 138l1.7 27.6c.4 6.5-1.8 13-6.5 17.7l-7.1 7.1c-24.6 24.6-24.6 64.4 0-89L343 378.1c24.6 24.6 64.4 24.6 89 0l7.1-7.1c4.7-4.7 6.9-11.2 6.5-17.7l-1.7-27.6L290.1 170l-1.7-27.6c-.4-6.5 1.8-13 6.5-17.7l7.1-7.1c24.6-24.6 24.6-64.4 0-89L239.1 36.9z"/><circle cx="256" cy="350" r="100"/><circle cx="256" cy="230" r="60"/></svg>
    </div>
    
    <div class="decoration-svg top-8 right-4 w-16 h-16 animate-float" style="animation-delay: 1s; color: #f97316;">
        <svg viewBox="0 0 100 100" fill="currentColor"><title>L·ªìng ƒê√®n C√° Ch√©p</title><path d="M10 50 Q30 30, 50 35 Q70 30, 90 50 Q70 70, 50 65 Q30 70, 10 50 Z"/><path d="M90 50 L95 45 L95 55 Z" fill="#fde047"/><path d="M50 35 L50 20 Q55 25, 60 20 T50 35 Z" fill="#ef4444"/><path d="M50 65 V75 M45 70 V85 M55 70 V85" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
    </div>

    <!-- Modal Th√¥ng b√°o (Thay th·∫ø alert) -->
    <div id="messageModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 hidden modal-container p-4">
        <!-- ƒê√£ ƒëi·ªÅu ch·ªânh max-w-sm th√†nh max-w-md ƒë·ªÉ linh ho·∫°t h∆°n -->
        <div id="modalContent" class="bg-white p-6 rounded-xl shadow-2xl max-w-sm w-full mid-autumn-card transform scale-0 opacity-0 transition-all modal-content-animated">
            <h3 id="modalTitle" class="text-2xl font-black mb-4 text-center text-red-600 text-readable-outline">Th√¥ng b√°o</h3>
            <p id="modalMessage" class="mb-6 text-center text-gray-700"></p>
            <button id="closeModalBtn" class="w-full py-3 rounded-xl text-lg mid-autumn-btn font-bold">Quay l·∫°i</button>
        </div>
    </div>
    
    <div class="text-center w-full max-w-lg z-10 relative">
        <h1 class="text-4xl md:text-5xl font-black mb-4 lion-banner-title">
            V√≤ng Quay May M·∫Øn Trung Thu
        </h1>
        <p id="userIdDisplay" class="text-sm text-yellow-300 mb-2 text-readable-outline"></p>

        <!-- Trang ƒêƒÉng K√Ω (Flow B·∫Øt ƒë·∫ßu) -->
        <div id="registrationPage" class="page mid-autumn-card p-6 rounded-2xl shadow-lg flex flex-col items-center">
            <h2 class="text-2xl font-bold mb-4 text-red-600 text-readable-outline">ƒêƒÉng K√Ω Tham Gia</h2>
            <p class="mb-6 text-gray-600 text-sm">Vui l√≤ng nh·∫≠p th√¥ng tin ƒë·ªÉ nh·∫≠n S·ªë May M·∫Øn duy nh·∫•t (1-200).</p>
            
            <input type="text" id="facebookName" placeholder="Nh·∫≠p T√™n Facebook c·ªßa b·∫°n" class="w-full p-3 mb-3 border-2 border-red-400 rounded-lg focus:ring-red-500 focus:border-red-500 font-medium" required>
            <input type="tel" id="phoneNumber" placeholder="Nh·∫≠p S·ªë ƒëi·ªán tho·∫°i (D√πng ƒë·ªÉ ki·ªÉm tra duy nh·∫•t)" class="w-full p-3 mb-4 border-2 border-red-400 rounded-lg focus:ring-red-500 focus:border-red-500 font-medium" required>

            <button id="spinBtn" class="w-2/3 max-w-xs py-3 rounded-xl text-lg mid-autumn-btn font-bold hover:shadow-lg transition duration-300">
                ƒêƒÉng K√Ω & Quay S·ªë!
            </button>
            
            <p class="text-xs mt-3 text-red-500 italic text-readable-outline">M·ªói S·ªë ƒëi·ªán tho·∫°i ch·ªâ ƒë∆∞·ª£c quay 1 l·∫ßn.</p>
        </div>

        <!-- Trang Quay S·ªë (N√∫t QUAY m·ªõi) -->
        <div id="spinPage" class="page mid-autumn-card p-6 rounded-2xl shadow-lg flex flex-col items-center hidden">
            
            <div class="relative w-full mb-2">
                <svg viewBox="0 0 100 30" class="w-full h-10 text-yellow-500 animate-float" style="filter: drop-shadow(0 0 5px #f97316);">
                    <title>Banner Ch√∫c M·ª´ng L√¢n S∆∞ R·ªìng</title>
                    <rect x="5" y="5" width="90" height="20" rx="10" fill="#ef4444" stroke="#fcd34d" stroke-width="2"/>
                    <circle cx="20" cy="15" r="3" fill="#ffffff"/>
                    <circle cx="80" cy="15" r="3" fill="#ffffff"/>
                    <path d="M10 5 L15 2 Q20 10, 10 25 Z M90 5 L85 2 Q80 10, 90 25 Z" fill="#fcd34d"/>
                    <path d="M50 5 V0 M45 5 V0 M55 5 V0" stroke="#fcd34d" stroke-width="1.5" stroke-linecap="round"/>
                </svg>
                <p class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 text-lg font-black text-white text-readable-outline" style="text-shadow: 1px 1px 2px #000;">NH·∫¨N S·ªê MAY M·∫ÆN!</p>
            </div>
            
            <!-- V√≤ng Quay N·ª≠a Tr√™n (K√≠ch th∆∞·ªõc s·∫Ω thay ƒë·ªïi theo media query trong CSS) -->
            <div id="wheel-container" class="mb-4 relative">
                <!-- Wrapper ch·ªâ hi·ªÉn th·ªã n·ª≠a tr√™n -->
                <div id="wheel-wrapper">
                    <!-- B√°nh xe quay -->
                    <div id="wheel" class="animate-pulse-spin">
                        <!-- C√°c m·ªëc s·ªë (10, 20, 30, ...) ƒë∆∞·ª£c ch√®n b·∫±ng JS -->
                    </div>
                    <!-- Con tr·ªè/M≈©i t√™n ƒë√®n l·ªìng -->
                    <div class="lantern-pointer animate-lantern-glow">
                        <svg viewBox="0 0 100 100" fill="currentColor">
                            <path d="M50 10 L80 90 L50 70 L20 90 Z" />
                        </svg>
                    </div>
                </div>
            </div>
            
            <!-- Khung K·∫øt Qu·∫£ (Ban ƒë·∫ßu ·∫©n, ch·ªâ hi·ªán khi ƒëang quay ho·∫∑c ƒë√£ quay xong) -->
            <div id="resultContainer" class="mid-autumn-card p-4 rounded-xl border-red-600 border-2 w-full max-w-xs mb-4 text-center hidden">
                <p id="resultDisplay" class="text-xl font-black text-red-700 h-8 text-readable-outline">...</p>
            </div>

            <!-- N√öT QUAY M·ªöI (CH·ªú NG∆Ø·ªúI D√ôNG B·∫§M) -->
            <button id="actualSpinBtn" class="w-2/3 max-w-xs py-3 rounded-xl text-lg mid-autumn-btn font-bold hover:shadow-lg transition duration-300 animate-pulse mb-3">
                QUAY V√íNG MAY M·∫ÆN!
            </button>
            
            <button id="backToRegBtn" class="py-2 px-6 rounded-xl bg-gray-400 text-gray-800 font-bold hover:bg-gray-500">
                Quay l·∫°i ƒêƒÉng k√Ω
            </button>
        </div>

        <!-- Trang ƒêƒÉng Nh·∫≠p Admin -->
        <div id="adminLoginPage" class="page mid-autumn-card p-6 rounded-2xl shadow-lg hidden">
            <h2 class="text-2xl font-bold mb-4 text-red-600 text-readable-outline">ƒêƒÉng Nh·∫≠p Qu·∫£n Tr·ªã</h2>
            <input type="password" id="adminPassword" placeholder="Nh·∫≠p m·∫≠t kh·∫©u b√≠ m·∫≠t" class="w-full p-3 mb-3 border-2 border-red-400 rounded-lg focus:ring-red-500 focus:border-red-500 font-medium" required>
            <p id="adminLoginError" class="text-red-500 mb-3 h-5 text-sm text-readable-outline"></p>
            <button id="adminLoginBtn" class="w-full py-3 rounded-xl mid-autumn-btn font-bold mb-3">
                ƒêƒÉng Nh·∫≠p
            </button>
            <button id="backFromAdminBtn" class="w-full py-2 rounded-xl bg-gray-400 text-gray-800 font-bold hover:bg-gray-500">
                Quay l·∫°i
            </button>
        </div>

        <!-- Trang Qu·∫£n Tr·ªã (Admin Dashboard) -->
        <div id="adminDashboard" class="page mid-autumn-card p-6 rounded-2xl shadow-lg hidden text-left">
            <h2 class="text-2xl font-bold mb-4 text-red-600 text-center text-readable-outline">B·∫£ng ƒêi·ªÅu Khi·ªÉn Admin</h2>
            <!-- S·ª≠ d·ª•ng responsive grid -->
            <div class="grid grid-cols-1 sm:grid-cols-3 gap-3 text-sm text-center mb-4">
                <div class="p-2 bg-red-50 rounded-lg text-readable-outline">T·ªïng s·ªë: <span id="totalNumbers" class="text-blue-600 font-black">0</span></div>
                <div class="p-2 bg-red-50 rounded-lg text-readable-outline">ƒê√£ c·∫•p ph√°t: <span id="numbersAllocated" class="text-red-600 font-black">0</span></div>
                <div class="p-2 bg-red-50 rounded-lg text-readable-outline">C√≤n l·∫°i: <span id="numbersRemaining" class="text-green-600 font-black">0</span></div>
            </div>
            
            <hr class="my-4 border-red-300">
            
            <h3 class="text-xl font-bold mb-3 text-center text-red-600 text-readable-outline">L·ªãch S·ª≠ Quay S·ªë Chi Ti·∫øt</h3>
            <!-- TƒÉng max-h cho kh·∫£ nƒÉng cu·ªôn t·ªët h∆°n tr√™n PC -->
            <div class="overflow-y-auto max-h-96 custom-scrollbar mb-4"> 
                <table class="min-w-full table-auto border-collapse text-sm">
                    <thead>
                        <tr class="bg-red-200 text-red-800 sticky top-0">
                            <th class="p-2 text-left w-2/5">T√™n Facebook</th>
                            <th class="p-2 text-left w-2/5">S·ªë ƒëi·ªán tho·∫°i</th>
                            <th class="p-2 text-center w-1/5">S·ªë May M·∫Øn</th>
                            <th class="p-2 text-right w-2/5">Th·ªùi Gian</th>
                        </tr>
                    </thead>
                    <tbody id="adminSpinHistoryList">
                        <tr><td colspan="4" class="p-3 text-center text-gray-500">ƒêang t·∫£i d·ªØ li·ªáu...</td></tr>
                    </tbody>
                </table>
            </div>
            
            <button id="resetGameBtn" class="w-full py-3 rounded-xl bg-red-600 text-white font-bold hover:bg-red-700 transition duration-150 text-sm mb-3">
                ‚ö†Ô∏è Thi·∫øt L·∫≠p L·∫°i Game (Reset)
            </button>
            
            <button id="adminLogoutBtn" class="w-full py-2 rounded-xl bg-gray-400 text-gray-800 font-bold hover:bg-gray-500 text-sm">
                ƒêƒÉng Xu·∫•t
            </button>
        </div>
    </div>
    
    <!-- FOOTER V√Ä LI√äN K·∫æT ADMIN ·∫®N -->
    <footer class="mt-8 text-center text-xs text-white opacity-70">
        <p class="text-readable-outline">&copy; 2024 V√≤ng Quay Trung Thu.</p>
        <p class="mt-1">
            <a href="#" id="hiddenAdminLink" class="text-gray-400 hover:text-white transition duration-150 text-xs text-readable-outline">
                üîë Admin
            </a>
        </p>
    </footer>
    
</body>
</html>
